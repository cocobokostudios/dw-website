<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/_app.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/blog/%5Bid%5D.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/chunks/framework.e84fa698c7ee940652bd.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/chunks/commons.7c101d7f1672b68d7c1c.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/runtime/main-98aa3916935decc0cde3.js" as="script"/></head><body><div id="__next"><h1>Mocha Test Reports in VSTS</h1><article><div>mocha-in-vsts</div><div>Tue Aug 01 2017 06:19:00 GMT-0500 (Central Daylight Time)</div><div><p>Here's another dev thing I use: <a href="https://mochajs.org/">MochaJS</a> in <a href="https://www.visualstudio.com/team-services/continuous-integration/">Visual Studio Team Services (VSTS) builds</a> and display the test reports as part of the build reports. See? Like this.</p>
<p><img src="https://davidwesst.blob.core.windows.net/blog/mocha-in-vsts/vsts-test-results-in-action.gif" alt="Mocha Test Report in VSTS" title="Screenshot of a MochaJS test report in VSTS"></p>
<p>This wasn't me trying to fit a square peg into a round hole. VSTS is exceptionally flexible and it comes bundled with all the pieces you need to do this out of the box. The key is making sure that we setup our test runner to produce the output VSTS needs.</p>
<h2>Step 0: Assumptions</h2>
<p>I'm not going to explain how to do this, but I'm going to assume you have a project with tests that use <a href="https://mochajs.org/">MochaJS</a>. So, you can run <code>mocha</code> from the terminal and your tests run.</p>
<p>I'm also not going to explain that to use VSTS, you need a VSTS account. They are <a href="https://www.visualstudio.com/team-services/">free to start</a> and you'll need one to make this work. It's worth the effort.</p>
<h2>Step 1: Script Your Test Command</h2>
<p>Personally, I use <a href="https://docs.npmjs.com/misc/scripts">npm scripts</a> for this. I just figure out what my test command is, and then have the <code>npm test</code> script run that. In my project, I run the locally installed version of MochaJS and use the <code>recursive</code> flag.</p>
<pre><code>./node_modules/.bin/mocha --recursive
</code></pre>
<p>In my <em>package.json</em> file, I have:</p>
<pre><code>"scripts": {
    "test": "./node_modules/.bin/mocha --recursive"
}
</code></pre>
<p>You can just as easily use a Bash or Powershell script for this too if you're not a fan of npm scripts. But you should be.</p>
<h2>Step 2: Use the mocha-junit-reporter</h2>
<p>Woah, wait a minute? This is JavaScript not <em>Java</em>.</p>
<p>I know, but JUnit reports are a standard report format that is supported by VSTS. The key is making sure that our mocha test reports are being output into a format that VSTS can understand. VSTS does not care about your test report to standard out.</p>
<p>Mocha doesn't come bundled with a JUnit reporter, so I used <a href="https://github.com/michaelleeallen/mocha-junit-reporter">mocha-junit-reporter</a> which outputs a <em>test-results.xml</em> file to the root project directory by default. I don't like the default, so I have it output to a directory of my choosing.</p>
<p>So, first we run: <code>npm install --save-dev mocha-junit-reporter</code></p>
<p>Then, we update our <code>npm test</code> command in <em>package.json</em> to</p>
<pre><code>"scripts": {
    "test": "./node_modules/.bin/mocha --recursive --reporter mocha-unit-reporter --reporter-options mochaFile=./test-output/test-results.xml"
}
</code></pre>
<p>Don't forget to add test output directory to your <em>.gitignore</em> file.</p>
<h3>(OPTIONAL) Step 2a: Using Mutliple Reporters</h3>
<p>But now I can't see my tests in the terminal output!</p>
<p>I didn't like that either, so I fixed it by using another Mocha extension called <a href="https://github.com/stanleyhlng/mocha-multi-reporters">mocha-multi-reporters</a>. It lets us define mutlple reporters for MochaJS and specify reporter parameters in a <em>config.json</em> file that we save in the project root.</p>
<p>First, install the tool: <code>npm install --save-dev mocha-multi-reporters</code>.</p>
<p>Then, we update our <code>npm test</code> command to</p>
<pre><code>"scripts": {
    "test": "./node_modules/.bin/mocha --recursive --reporter=mocha-multi-reporters"
}
</code></pre>
<p>And finally, we add a <em>config.json</em> file to the project root. I'm using the spec and mocha-junit-reporter, which result in this <em>config.json</em>:</p>
<pre><code>{
    "reporterEnabled": "spec,mocha-junit-reporter",
    "mochaJunitReporterReporterOptions": {
        "mochaFile": "./.test_output/test-results.xml"
    }
}
</code></pre>
<p>It's not perfect, but it works well enough for my purposes.</p>
<h4>Gotcha! You should use Mocha-Multi</h4>
<p>I tried using <a href="https://github.com/glenjamin/mocha-multi">mocha-multi</a> and I couldn't get it to work with the parameter for <a href="https://github.com/michaelleeallen/mocha-junit-reporter">mocha-junit-reporter</a>.</p>
<h4>Gotcha! This produces an xunit.xml file in the root directory</h4>
<p>It's a <a href="https://github.com/stanleyhlng/mocha-multi-reporters/issues/35" title="My bug report for the XUnit issue in mocha-multi-reporters">bug with mocha-multi-reporters</a> that I've reported. I'm hoping to get a pull request in for it soon, as it's a pretty easy fix.</p>
<p>The workaround is to add <em>xunit.xml</em> to your <em>.gitignore</em> file and ignore it yourself.</p>
<h2>Step 3: Run Test Script in your VSTS Build</h2>
<p>To run your test script, you need to add a build task  in VSTS. In our case, we're adding the NPM buid task, and configuring it to run our <code>npm test</code> command. The build task properties I use are:</p>
<ul>
<li>Version: 1.*</li>
<li>Display Name: npm test</li>
<li>Command: custom</li>
<li>Command and arguments: test</li>
</ul>
<p>Here's what it looks like:</p>
<p><img src="https://davidwesst.blob.core.windows.net/blog/mocha-in-vsts/vsts-npm-test-task.png" alt="Screenshot of npm build step" title="Screenshot of VSTS Build Task that runs the tests"></p>
<h2>Step 4: Publish the Test Results in VSTS</h2>
<p>For our last step, we need to publish the test results report to VSTS and tell it how to read it.</p>
<p>We do this with the Publish Test Results build step in VSTS and configure it with the following properties.</p>
<ul>
<li>Version: 2.*</li>
<li>Display name: Publish Test Results | Mocha</li>
<li>Test result format: JUnit</li>
<li>Search folder: $(System.DefaultWorkingDirectory)</li>
</ul>
<p>Which looks something like this:</p>
<p><img src="https://davidwesst.blob.core.windows.net/blog/mocha-in-vsts/vsts-publish-test-results.png" alt="VSTS Publish Test Results Build Step" title="Screenshot of VSTS Build Task that consumes the test report"></p>
<h2>Step 5: Done</h2>
<p>And with that, you're good to go to capture and explore your MochaJS test results from within your VSTS build report.</p>
<p>Happy test reporting!</p>
</div></article><footer><a href="/blog">Back to Post Listing</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"mocha-in-vsts","htmlContent":"\u003cp\u003eHere's another dev thing I use: \u003ca href=\"https://mochajs.org/\"\u003eMochaJS\u003c/a\u003e in \u003ca href=\"https://www.visualstudio.com/team-services/continuous-integration/\"\u003eVisual Studio Team Services (VSTS) builds\u003c/a\u003e and display the test reports as part of the build reports. See? Like this.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://davidwesst.blob.core.windows.net/blog/mocha-in-vsts/vsts-test-results-in-action.gif\" alt=\"Mocha Test Report in VSTS\" title=\"Screenshot of a MochaJS test report in VSTS\"\u003e\u003c/p\u003e\n\u003cp\u003eThis wasn't me trying to fit a square peg into a round hole. VSTS is exceptionally flexible and it comes bundled with all the pieces you need to do this out of the box. The key is making sure that we setup our test runner to produce the output VSTS needs.\u003c/p\u003e\n\u003ch2\u003eStep 0: Assumptions\u003c/h2\u003e\n\u003cp\u003eI'm not going to explain how to do this, but I'm going to assume you have a project with tests that use \u003ca href=\"https://mochajs.org/\"\u003eMochaJS\u003c/a\u003e. So, you can run \u003ccode\u003emocha\u003c/code\u003e from the terminal and your tests run.\u003c/p\u003e\n\u003cp\u003eI'm also not going to explain that to use VSTS, you need a VSTS account. They are \u003ca href=\"https://www.visualstudio.com/team-services/\"\u003efree to start\u003c/a\u003e and you'll need one to make this work. It's worth the effort.\u003c/p\u003e\n\u003ch2\u003eStep 1: Script Your Test Command\u003c/h2\u003e\n\u003cp\u003ePersonally, I use \u003ca href=\"https://docs.npmjs.com/misc/scripts\"\u003enpm scripts\u003c/a\u003e for this. I just figure out what my test command is, and then have the \u003ccode\u003enpm test\u003c/code\u003e script run that. In my project, I run the locally installed version of MochaJS and use the \u003ccode\u003erecursive\u003c/code\u003e flag.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e./node_modules/.bin/mocha --recursive\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIn my \u003cem\u003epackage.json\u003c/em\u003e file, I have:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"scripts\": {\n    \"test\": \"./node_modules/.bin/mocha --recursive\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can just as easily use a Bash or Powershell script for this too if you're not a fan of npm scripts. But you should be.\u003c/p\u003e\n\u003ch2\u003eStep 2: Use the mocha-junit-reporter\u003c/h2\u003e\n\u003cp\u003eWoah, wait a minute? This is JavaScript not \u003cem\u003eJava\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eI know, but JUnit reports are a standard report format that is supported by VSTS. The key is making sure that our mocha test reports are being output into a format that VSTS can understand. VSTS does not care about your test report to standard out.\u003c/p\u003e\n\u003cp\u003eMocha doesn't come bundled with a JUnit reporter, so I used \u003ca href=\"https://github.com/michaelleeallen/mocha-junit-reporter\"\u003emocha-junit-reporter\u003c/a\u003e which outputs a \u003cem\u003etest-results.xml\u003c/em\u003e file to the root project directory by default. I don't like the default, so I have it output to a directory of my choosing.\u003c/p\u003e\n\u003cp\u003eSo, first we run: \u003ccode\u003enpm install --save-dev mocha-junit-reporter\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eThen, we update our \u003ccode\u003enpm test\u003c/code\u003e command in \u003cem\u003epackage.json\u003c/em\u003e to\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"scripts\": {\n    \"test\": \"./node_modules/.bin/mocha --recursive --reporter mocha-unit-reporter --reporter-options mochaFile=./test-output/test-results.xml\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDon't forget to add test output directory to your \u003cem\u003e.gitignore\u003c/em\u003e file.\u003c/p\u003e\n\u003ch3\u003e(OPTIONAL) Step 2a: Using Mutliple Reporters\u003c/h3\u003e\n\u003cp\u003eBut now I can't see my tests in the terminal output!\u003c/p\u003e\n\u003cp\u003eI didn't like that either, so I fixed it by using another Mocha extension called \u003ca href=\"https://github.com/stanleyhlng/mocha-multi-reporters\"\u003emocha-multi-reporters\u003c/a\u003e. It lets us define mutlple reporters for MochaJS and specify reporter parameters in a \u003cem\u003econfig.json\u003c/em\u003e file that we save in the project root.\u003c/p\u003e\n\u003cp\u003eFirst, install the tool: \u003ccode\u003enpm install --save-dev mocha-multi-reporters\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eThen, we update our \u003ccode\u003enpm test\u003c/code\u003e command to\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\"scripts\": {\n    \"test\": \"./node_modules/.bin/mocha --recursive --reporter=mocha-multi-reporters\"\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd finally, we add a \u003cem\u003econfig.json\u003c/em\u003e file to the project root. I'm using the spec and mocha-junit-reporter, which result in this \u003cem\u003econfig.json\u003c/em\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e{\n    \"reporterEnabled\": \"spec,mocha-junit-reporter\",\n    \"mochaJunitReporterReporterOptions\": {\n        \"mochaFile\": \"./.test_output/test-results.xml\"\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt's not perfect, but it works well enough for my purposes.\u003c/p\u003e\n\u003ch4\u003eGotcha! You should use Mocha-Multi\u003c/h4\u003e\n\u003cp\u003eI tried using \u003ca href=\"https://github.com/glenjamin/mocha-multi\"\u003emocha-multi\u003c/a\u003e and I couldn't get it to work with the parameter for \u003ca href=\"https://github.com/michaelleeallen/mocha-junit-reporter\"\u003emocha-junit-reporter\u003c/a\u003e.\u003c/p\u003e\n\u003ch4\u003eGotcha! This produces an xunit.xml file in the root directory\u003c/h4\u003e\n\u003cp\u003eIt's a \u003ca href=\"https://github.com/stanleyhlng/mocha-multi-reporters/issues/35\" title=\"My bug report for the XUnit issue in mocha-multi-reporters\"\u003ebug with mocha-multi-reporters\u003c/a\u003e that I've reported. I'm hoping to get a pull request in for it soon, as it's a pretty easy fix.\u003c/p\u003e\n\u003cp\u003eThe workaround is to add \u003cem\u003exunit.xml\u003c/em\u003e to your \u003cem\u003e.gitignore\u003c/em\u003e file and ignore it yourself.\u003c/p\u003e\n\u003ch2\u003eStep 3: Run Test Script in your VSTS Build\u003c/h2\u003e\n\u003cp\u003eTo run your test script, you need to add a build task  in VSTS. In our case, we're adding the NPM buid task, and configuring it to run our \u003ccode\u003enpm test\u003c/code\u003e command. The build task properties I use are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVersion: 1.*\u003c/li\u003e\n\u003cli\u003eDisplay Name: npm test\u003c/li\u003e\n\u003cli\u003eCommand: custom\u003c/li\u003e\n\u003cli\u003eCommand and arguments: test\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHere's what it looks like:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://davidwesst.blob.core.windows.net/blog/mocha-in-vsts/vsts-npm-test-task.png\" alt=\"Screenshot of npm build step\" title=\"Screenshot of VSTS Build Task that runs the tests\"\u003e\u003c/p\u003e\n\u003ch2\u003eStep 4: Publish the Test Results in VSTS\u003c/h2\u003e\n\u003cp\u003eFor our last step, we need to publish the test results report to VSTS and tell it how to read it.\u003c/p\u003e\n\u003cp\u003eWe do this with the Publish Test Results build step in VSTS and configure it with the following properties.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eVersion: 2.*\u003c/li\u003e\n\u003cli\u003eDisplay name: Publish Test Results | Mocha\u003c/li\u003e\n\u003cli\u003eTest result format: JUnit\u003c/li\u003e\n\u003cli\u003eSearch folder: $(System.DefaultWorkingDirectory)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhich looks something like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://davidwesst.blob.core.windows.net/blog/mocha-in-vsts/vsts-publish-test-results.png\" alt=\"VSTS Publish Test Results Build Step\" title=\"Screenshot of VSTS Build Task that consumes the test report\"\u003e\u003c/p\u003e\n\u003ch2\u003eStep 5: Done\u003c/h2\u003e\n\u003cp\u003eAnd with that, you're good to go to capture and explore your MochaJS test results from within your VSTS build report.\u003c/p\u003e\n\u003cp\u003eHappy test reporting!\u003c/p\u003e\n","title":"Mocha Test Reports in VSTS","category":["development"],"tags":["javascript","visual studio team services","mocha","testing"],"excerpt":"Here's another dev thing I do: Display my MochaJS test report in the Visual Studio Team Services (VSTS) build report.","layout":"post","date":"Tue Aug 01 2017 06:19:00 GMT-0500 (Central Daylight Time)","authorId":"david_wesst"}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"mocha-in-vsts"},"buildId":"-9wn_hi6_-Q32OgH9YOcv","assetPrefix":"https://www.davidwesst.com","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="https://www.davidwesst.com/_next/static/runtime/polyfills-10c88b4b028d13fe33de.js"></script><script async="" data-next-page="/_app" src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/_app.js"></script><script async="" data-next-page="/blog/[id]" src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/blog/%5Bid%5D.js"></script><script src="https://www.davidwesst.com/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="https://www.davidwesst.com/_next/static/chunks/framework.e84fa698c7ee940652bd.js" async=""></script><script src="https://www.davidwesst.com/_next/static/chunks/commons.7c101d7f1672b68d7c1c.js" async=""></script><script src="https://www.davidwesst.com/_next/static/runtime/main-98aa3916935decc0cde3.js" async=""></script><script src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/_buildManifest.js" async=""></script><script src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/_ssgManifest.js" async=""></script></body></html>