<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/_app.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/blog/%5Bid%5D.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/chunks/framework.e84fa698c7ee940652bd.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/chunks/commons.7c101d7f1672b68d7c1c.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/runtime/main-98aa3916935decc0cde3.js" as="script"/></head><body><div id="__next"><h1>How to Blog with VSTS (Part 4)</h1><article><div>how-to-blog-with-vsts-part-4</div><div>Mon Nov 21 2016 01:30:00 GMT-0600 (Central Standard Time)</div><div><p><em>This is part 4 of 5 of my <strong>How to Blog with VSTS</strong> series. Links to the other parts will be added as they are made available.</em></p>
<ul>
<li><a href="https://blog.davidwesst.com/2016/10/How-to-Blog-with-VSTS-Part-1/">Part 1: Setup</a></li>
<li><a href="https://blog.davidwesst.com/2016/11/How-to-Blog-with-VSTS-Part-2/">Part 2: Code</a> </li>
<li><a href="https://blog.davidwesst.com/2016/11/How-to-Blog-with-VSTS-Part-3/">Part 3: Work</a></li>
<li><a href="https://blog.davidwesst.com/2016/11/How-to-Blog-with-VSTS-Part-4/">Part 4: Build</a></li>
<li>Part 5: Release</li>
</ul>
<hr>
<p>I've been tinkering with Visual Studio Team Services off and on since its public release, but never did anything really productive with it. Over the past couple of weeks, I finally bit the bullet and decided to move my most prevelant personal project into VSTS: this blog.</p>
<p>In this post we are we going to create a build script in VSTS so we can generate our blog content consistently and get it ready to deploy somewhere.</p>
<h2>Creating Our Build Script</h2>
<p>First, we need to navigate over to the <em>Build</em> section of VSTS, which you can find in the navigation menu at the top of the page.</p>
<!-- image of build menu item -->
<p><img src="http://i.imgur.com/7S55XWDl.png" alt="Build and Releases Menu"></p>
<p>This is where we're going to create our build script by hitting the "Create New Build" button.</p>
<!-- image of new build button -->
<p><img src="http://i.imgur.com/6uCoEEFl.png" alt="New Build Button"></p>
<h2>Adding Build Tasks (Hexo Edition)</h2>
<p>VSTS provides plenty of build tasks. Statically generated sites will have different build tasks, so I'm going to walk you through the build tasks I setup for <a href="https://hexo.io/">Hexo</a>.</p>
<p>It's pretty straight forward, but it helps to list them out in order.</p>
<ol>
<li>Install global npm dependencies</li>
<li>Install local npm dependencies</li>
<li>Other stuff that needs doing</li>
<li>Generate site content</li>
<li>Store site content as build asset OR Deploy!</li>
</ol>
<p>Let's go through these.</p>
<h3>npm Global Dependencies</h3>
<p>In this case, I only have one which is <code>hexo-cli</code> so that I can run the <code>hexo generate</code> command later on in our build. </p>
<p>You could add it's own npm task here, by adding a new task and setting the parameters of the task accordingly.</p>
<!-- npm install -g task -->
<p><img src="http://i.imgur.com/h1HFRAJl.png" alt="npm task"></p>
<p>Personally, I don't have a separate task. I use my project's <code>package.json</code> and set a <a href="https://docs.npmjs.com/misc/scripts"><em>preinstall</em> script</a> which gets run before the <code>npm install</code> command.</p>
<p>Either one works really. I just like having my source code setup be as simple as <code>npm install</code> and then <code>npm start</code> to run the site.</p>
<h3>npm Local Dependencies</h3>
<p>Just like the previous, except this time we're using the default parameters. We just need the build to run <code>npm install</code> and let it do it's thing.</p>
<h3>Other Stuff</h3>
<p>Every project is a unique snowflake, and sometimes you have some extra tasks you need accomplished. In my case, I have a custom theme that I build every time. To accomplish this, I have a PowerShell script in the <code>\tools</code> directory of my source code that gets run every time.</p>
<!-- powershell task with parameters -->
<p><img src="http://i.imgur.com/aXmLKcml.png" alt="PowerShell Task with Parameters"></p>
<h4>CMD, Powershell, and Bash Tasks</h4>
<p>You're not limited to just PowerShell, but you can have CMD or even bash shell scripts executed. The only caveat of running these is making sure that the build server being used to run your build has these capabilities.</p>
<p>If you're using the hosted server, like I do, then PowerShell and CMD are your best bets. I did try to have both PowerShell and Bash, which resulted in getting a message saying I "didn't have a host that had these capabilities".</p>
<p>Maybe in time we'll have hosted servers that do both, but until then you'll need to setup your own server to handle these unique dependencies or try can conform your code to use one or the other.</p>
<h4>Keeping it Open Source</h4>
<p>If you're looking to keep your source open on, you'll likely want to push it out of VSTS and into GitHub or somewhere where the public can get their hands and eyes on it.    </p>
<p>This is the job for another script task. In my case, I followed <a href="https://nkdagility.com/open-source-vsts-tfs-github-better-devops/">this blog post</a> that <a href="http://www.westerndevs.com/bios/dylan_smith/">Dylan Smith</a> directed me to and followed along.</p>
<h3>Generate Content</h3>
<p>Again, another script task. But this one is easier, as we're just running <code>hexo generate</code>. </p>
<p>You could write a whole script file for this too, but I opted to make it simple and just configure the build task itself.</p>
<!-- hexo generate build task -->
<p><img src="http://i.imgur.com/dGWjUTNl.png" alt="hexo generate build task"></p>
<h3>Save and Publish Site Content</h3>
<p>We'll discuss this further when we get to <a href="#">releases</a> but we need to save our content assets so we can publish them later. For hexo, this is usually the contents of the <code>public</code> folder.</p>
<p>To handle this, I use the <em>Copy and Publish Build Assets</em> task and configure it to save the contents of the <code>public</code> folder so that it persists after the build is complete.</p>
<!-- publish assets task -->
<p><img src="http://i.imgur.com/LJTk1wKl.png" alt="Copy and Publish Build Assets"></p>
<h4>...or Deploy!</h4>
<p>Another option is to just deploy it directly from the build script and skip the whole <a href="#">release management</a> component. This would allow you do a deployment everytime you build, making sure the latest source code is live.</p>
<p>Again, it's a matter of preference. The reason I like <a href="#">releases</a> over this model is to be able to manage the release of source code independenly of the build itself. </p>
<h2>Triggering the Build</h2>
<p>I have two build scripts that are almost identical. One that I use for development and continuous integration. The other is scheduled to prepare a for a weekly release of my blog.</p>
<p>VSTS accomodates both of these options, which you can see in the <em>Triggers</em> tab of the build script.</p>
<!-- image of the triggers tab -->
<p><img src="http://i.imgur.com/YHlzH7Cl.png" alt="Triggers Tab"></p>
<p>For my development build script, I trigger the build on pushes to the <code>master</code> branch of my repository. I have also configured this build script to run on a private build agent that I have setup.</p>
<p>I won't be covering private build agents in this series of posts, but I assure you it's very easy. I setup my development machine as a private build server, and had it setup in about 15 minutes after following <a href="https://www.visualstudio.com/en-us/docs/build/admin/agents/v2-windows">these instructions</a>.</p>
<h2>Next Up: Releases!</h2>
<p>We're almost done, and technically you don't need the next step if you just want to do continual deployment and have a deployment step in your build script. That being said, I like having the release pipeline as it gives me a few other things to ensure my blogging goes out without a hitch.</p>
<p>More on that <a href="#">next time</a>.</p>
</div></article><footer><a href="/blog">Back to Post Listing</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"how-to-blog-with-vsts-part-4","htmlContent":"\u003cp\u003e\u003cem\u003eThis is part 4 of 5 of my \u003cstrong\u003eHow to Blog with VSTS\u003c/strong\u003e series. Links to the other parts will be added as they are made available.\u003c/em\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.davidwesst.com/2016/10/How-to-Blog-with-VSTS-Part-1/\"\u003ePart 1: Setup\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.davidwesst.com/2016/11/How-to-Blog-with-VSTS-Part-2/\"\u003ePart 2: Code\u003c/a\u003e \u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.davidwesst.com/2016/11/How-to-Blog-with-VSTS-Part-3/\"\u003ePart 3: Work\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.davidwesst.com/2016/11/How-to-Blog-with-VSTS-Part-4/\"\u003ePart 4: Build\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003ePart 5: Release\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003eI've been tinkering with Visual Studio Team Services off and on since its public release, but never did anything really productive with it. Over the past couple of weeks, I finally bit the bullet and decided to move my most prevelant personal project into VSTS: this blog.\u003c/p\u003e\n\u003cp\u003eIn this post we are we going to create a build script in VSTS so we can generate our blog content consistently and get it ready to deploy somewhere.\u003c/p\u003e\n\u003ch2\u003eCreating Our Build Script\u003c/h2\u003e\n\u003cp\u003eFirst, we need to navigate over to the \u003cem\u003eBuild\u003c/em\u003e section of VSTS, which you can find in the navigation menu at the top of the page.\u003c/p\u003e\n\u003c!-- image of build menu item --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/7S55XWDl.png\" alt=\"Build and Releases Menu\"\u003e\u003c/p\u003e\n\u003cp\u003eThis is where we're going to create our build script by hitting the \"Create New Build\" button.\u003c/p\u003e\n\u003c!-- image of new build button --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/6uCoEEFl.png\" alt=\"New Build Button\"\u003e\u003c/p\u003e\n\u003ch2\u003eAdding Build Tasks (Hexo Edition)\u003c/h2\u003e\n\u003cp\u003eVSTS provides plenty of build tasks. Statically generated sites will have different build tasks, so I'm going to walk you through the build tasks I setup for \u003ca href=\"https://hexo.io/\"\u003eHexo\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eIt's pretty straight forward, but it helps to list them out in order.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eInstall global npm dependencies\u003c/li\u003e\n\u003cli\u003eInstall local npm dependencies\u003c/li\u003e\n\u003cli\u003eOther stuff that needs doing\u003c/li\u003e\n\u003cli\u003eGenerate site content\u003c/li\u003e\n\u003cli\u003eStore site content as build asset OR Deploy!\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eLet's go through these.\u003c/p\u003e\n\u003ch3\u003enpm Global Dependencies\u003c/h3\u003e\n\u003cp\u003eIn this case, I only have one which is \u003ccode\u003ehexo-cli\u003c/code\u003e so that I can run the \u003ccode\u003ehexo generate\u003c/code\u003e command later on in our build. \u003c/p\u003e\n\u003cp\u003eYou could add it's own npm task here, by adding a new task and setting the parameters of the task accordingly.\u003c/p\u003e\n\u003c!-- npm install -g task --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/h1HFRAJl.png\" alt=\"npm task\"\u003e\u003c/p\u003e\n\u003cp\u003ePersonally, I don't have a separate task. I use my project's \u003ccode\u003epackage.json\u003c/code\u003e and set a \u003ca href=\"https://docs.npmjs.com/misc/scripts\"\u003e\u003cem\u003epreinstall\u003c/em\u003e script\u003c/a\u003e which gets run before the \u003ccode\u003enpm install\u003c/code\u003e command.\u003c/p\u003e\n\u003cp\u003eEither one works really. I just like having my source code setup be as simple as \u003ccode\u003enpm install\u003c/code\u003e and then \u003ccode\u003enpm start\u003c/code\u003e to run the site.\u003c/p\u003e\n\u003ch3\u003enpm Local Dependencies\u003c/h3\u003e\n\u003cp\u003eJust like the previous, except this time we're using the default parameters. We just need the build to run \u003ccode\u003enpm install\u003c/code\u003e and let it do it's thing.\u003c/p\u003e\n\u003ch3\u003eOther Stuff\u003c/h3\u003e\n\u003cp\u003eEvery project is a unique snowflake, and sometimes you have some extra tasks you need accomplished. In my case, I have a custom theme that I build every time. To accomplish this, I have a PowerShell script in the \u003ccode\u003e\\tools\u003c/code\u003e directory of my source code that gets run every time.\u003c/p\u003e\n\u003c!-- powershell task with parameters --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/aXmLKcml.png\" alt=\"PowerShell Task with Parameters\"\u003e\u003c/p\u003e\n\u003ch4\u003eCMD, Powershell, and Bash Tasks\u003c/h4\u003e\n\u003cp\u003eYou're not limited to just PowerShell, but you can have CMD or even bash shell scripts executed. The only caveat of running these is making sure that the build server being used to run your build has these capabilities.\u003c/p\u003e\n\u003cp\u003eIf you're using the hosted server, like I do, then PowerShell and CMD are your best bets. I did try to have both PowerShell and Bash, which resulted in getting a message saying I \"didn't have a host that had these capabilities\".\u003c/p\u003e\n\u003cp\u003eMaybe in time we'll have hosted servers that do both, but until then you'll need to setup your own server to handle these unique dependencies or try can conform your code to use one or the other.\u003c/p\u003e\n\u003ch4\u003eKeeping it Open Source\u003c/h4\u003e\n\u003cp\u003eIf you're looking to keep your source open on, you'll likely want to push it out of VSTS and into GitHub or somewhere where the public can get their hands and eyes on it.    \u003c/p\u003e\n\u003cp\u003eThis is the job for another script task. In my case, I followed \u003ca href=\"https://nkdagility.com/open-source-vsts-tfs-github-better-devops/\"\u003ethis blog post\u003c/a\u003e that \u003ca href=\"http://www.westerndevs.com/bios/dylan_smith/\"\u003eDylan Smith\u003c/a\u003e directed me to and followed along.\u003c/p\u003e\n\u003ch3\u003eGenerate Content\u003c/h3\u003e\n\u003cp\u003eAgain, another script task. But this one is easier, as we're just running \u003ccode\u003ehexo generate\u003c/code\u003e. \u003c/p\u003e\n\u003cp\u003eYou could write a whole script file for this too, but I opted to make it simple and just configure the build task itself.\u003c/p\u003e\n\u003c!-- hexo generate build task --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/dGWjUTNl.png\" alt=\"hexo generate build task\"\u003e\u003c/p\u003e\n\u003ch3\u003eSave and Publish Site Content\u003c/h3\u003e\n\u003cp\u003eWe'll discuss this further when we get to \u003ca href=\"#\"\u003ereleases\u003c/a\u003e but we need to save our content assets so we can publish them later. For hexo, this is usually the contents of the \u003ccode\u003epublic\u003c/code\u003e folder.\u003c/p\u003e\n\u003cp\u003eTo handle this, I use the \u003cem\u003eCopy and Publish Build Assets\u003c/em\u003e task and configure it to save the contents of the \u003ccode\u003epublic\u003c/code\u003e folder so that it persists after the build is complete.\u003c/p\u003e\n\u003c!-- publish assets task --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/LJTk1wKl.png\" alt=\"Copy and Publish Build Assets\"\u003e\u003c/p\u003e\n\u003ch4\u003e...or Deploy!\u003c/h4\u003e\n\u003cp\u003eAnother option is to just deploy it directly from the build script and skip the whole \u003ca href=\"#\"\u003erelease management\u003c/a\u003e component. This would allow you do a deployment everytime you build, making sure the latest source code is live.\u003c/p\u003e\n\u003cp\u003eAgain, it's a matter of preference. The reason I like \u003ca href=\"#\"\u003ereleases\u003c/a\u003e over this model is to be able to manage the release of source code independenly of the build itself. \u003c/p\u003e\n\u003ch2\u003eTriggering the Build\u003c/h2\u003e\n\u003cp\u003eI have two build scripts that are almost identical. One that I use for development and continuous integration. The other is scheduled to prepare a for a weekly release of my blog.\u003c/p\u003e\n\u003cp\u003eVSTS accomodates both of these options, which you can see in the \u003cem\u003eTriggers\u003c/em\u003e tab of the build script.\u003c/p\u003e\n\u003c!-- image of the triggers tab --\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/YHlzH7Cl.png\" alt=\"Triggers Tab\"\u003e\u003c/p\u003e\n\u003cp\u003eFor my development build script, I trigger the build on pushes to the \u003ccode\u003emaster\u003c/code\u003e branch of my repository. I have also configured this build script to run on a private build agent that I have setup.\u003c/p\u003e\n\u003cp\u003eI won't be covering private build agents in this series of posts, but I assure you it's very easy. I setup my development machine as a private build server, and had it setup in about 15 minutes after following \u003ca href=\"https://www.visualstudio.com/en-us/docs/build/admin/agents/v2-windows\"\u003ethese instructions\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eNext Up: Releases!\u003c/h2\u003e\n\u003cp\u003eWe're almost done, and technically you don't need the next step if you just want to do continual deployment and have a deployment step in your build script. That being said, I like having the release pipeline as it gives me a few other things to ensure my blogging goes out without a hitch.\u003c/p\u003e\n\u003cp\u003eMore on that \u003ca href=\"#\"\u003enext time\u003c/a\u003e.\u003c/p\u003e\n","layout":"post","title":"How to Blog with VSTS (Part 4)","categories":["alm"],"tags":["visual studio team services","vsts","alm","hexo"],"date":"Mon Nov 21 2016 01:30:00 GMT-0600 (Central Standard Time)","updated":"Mon Nov 21 2016 01:30:00 GMT-0600 (Central Standard Time)","excerpt":"I wanted to understand how to use Visual Studio Team Services (VSTS) for a \"real\" project. Being a noob, I decided to move my blog to VSTS to understand how _any_ project can benefit from ALM practices using VSTS. In part 4 of 5, we setup a _Build_ script.","authorId":"david_wesst"}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"how-to-blog-with-vsts-part-4"},"buildId":"-9wn_hi6_-Q32OgH9YOcv","assetPrefix":"https://www.davidwesst.com","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="https://www.davidwesst.com/_next/static/runtime/polyfills-10c88b4b028d13fe33de.js"></script><script async="" data-next-page="/_app" src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/_app.js"></script><script async="" data-next-page="/blog/[id]" src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/blog/%5Bid%5D.js"></script><script src="https://www.davidwesst.com/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="https://www.davidwesst.com/_next/static/chunks/framework.e84fa698c7ee940652bd.js" async=""></script><script src="https://www.davidwesst.com/_next/static/chunks/commons.7c101d7f1672b68d7c1c.js" async=""></script><script src="https://www.davidwesst.com/_next/static/runtime/main-98aa3916935decc0cde3.js" async=""></script><script src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/_buildManifest.js" async=""></script><script src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/_ssgManifest.js" async=""></script></body></html>