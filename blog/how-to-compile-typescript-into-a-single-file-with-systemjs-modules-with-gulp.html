<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/_app.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/blog/%5Bid%5D.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/chunks/framework.e84fa698c7ee940652bd.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/chunks/commons.7c101d7f1672b68d7c1c.js" as="script"/><link rel="preload" href="https://www.davidwesst.com/_next/static/runtime/main-98aa3916935decc0cde3.js" as="script"/></head><body><div id="__next"><h1>How to Compile TypeScript into a Single File with SystemJS Modules with Gulp</h1><article><div>how-to-compile-typescript-into-a-single-file-with-systemjs-modules-with-gulp</div><div>Tue Mar 14 2017 04:47:22 GMT-0500 (Central Daylight Time)</div><div><p>I've been messing around with TypeScript again for my <a href="https://blog.davidwesst.com/2017/03/Intital-Thoughts-on-Using-Phaser/">game project</a> and wanted a module loader to consume the single file produced by the TypeScript compiler. This time around I decided to use SystemJS and figured I'd share the lessons I learned along the way.</p>
<h5>Sample Project</h5>
<p>If you're interested in playing with the code, you can checkout <a href="https://github.com/davidwesst/ts-systemjs">this GitHub project</a> I setup just for that reason.</p>
<h5>Previous Post</h5>
<p>I also posted about doing the same sort of thing <a href="https://blog.davidwesst.com/2016/09/How-to-Compile-Typescript-into-a-Single-File-with-AMD-Modules/">with AMD and RequireJS</a> complete with <a href="https://github.com/davidwesst/ts-project-template">a GitHub sample project</a></p>
<h2>Project Breakdown</h2>
<p>Here's the gist of it. My project has the following requirements:</p>
<ol>
<li>Source code in TypeScript, organized in to multiple modules</li>
<li>Load external modules into application as dependencies</li>
<li>Transpile down to a single bundle file</li>
<li>Load the bundle in the browser</li>
</ol>
<p>It seems pretty straight forward, right? Plus, because I'm using TypeScript I figured this would be easy peezy lemon-squeezy with the <a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">TypeScript compiler</a> and rich documentation.</p>
<p>As it turns out, it wasn't that simple.</p>
<h3>Wait. Where's GulpJS?</h3>
<p>It's in the sample project handling the transpiling the TypeScript through a task. </p>
<p>It's actually not required, but rather a convienience for keeping all my build tasks together. I just put it in the title, because it matches the previous post.</p>
<h2>Problem 1: Using an External Module</h2>
<p>I wanted to use <a href="https://momentjs.com/">Moment.js</a> to help handle date objects with my code.</p>
<p>There were two parts to this: </p>
<ul>
<li>Getting it working in the development environment</li>
<li>Getting it bundled up with SystemJS.</li>
</ul>
<h3>Using it in Development</h3>
<p>I use <a href="https://code.visualstudio.com/">Visual Studio Code</a>, which is a great TypeScript development environment. </p>
<p>Normally, you would use the <a href="https://www.npmjs.com/search?q=%40types"><code>@types</code></a> collection of defintion files from the NPM which is wired up by default. For Moment, we need to break that.</p>
<p>The definition file for Moment is found in the library itself. Since I use NPM to handle all my dependencies, you just set this up in your <code>tsconfig.json</code> file.</p>
<p><img src="http://i.imgur.com/TyAgU0N.png"></p>
<p>Then, in code, we import it.</p>
<pre><code class="language-javascript">import moment from "moment";
</code></pre>
<p>Remember: if your project is already using <code>@types</code> definition files, you'll need to add that folder to the <code>typeRoots</code> collection yourself.</p>
<h3>Bundling it Up</h3>
<p>Because we're using SystemJS, we need to do is configure it as a path to understand where to find the library when it gets referenced.</p>
<p>In the <a href="https://github.com/davidwesst/ts-systemjs">sample project</a>, we do it in <code>script</code> tag on the HTML page, but you can do this in wherever you end up doing your SystemJS configuration.</p>
<pre><code class="language-javascript">SystemJS.config({
    "paths": {
        "moment": "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"
    }
});
</code></pre>
<h2>Problem 2: Loading the Bundle</h2>
<p>Making a bundle is easy. Consuming the bundle is something different.</p>
<h3>Making a Bundle</h3>
<p>If you're interested in bundling your code into a single file with the compiler, you're limited to AMD or SystemJS modules. This is configured in the <code>tsconfig.json</code> file included in <a href="https://github.com/davidwesst/ts-systemjs">the sample project</a> with the module property. You can read more about it <a href="https://www.typescriptlang.org/docs/handbook/modules.html">here in the TypeScript Handbook</a>.</p>
<p><img src="http://i.imgur.com/gUGeHfI.png"></p>
<h3>Consuming the Bundle</h3>
<p>This is where I got stuck.</p>
<p>Now I have this fancy bundle, but I need to figure out how to consume it in my HTML page. The solution is pretty simple, but it took some research and some tinkering, but I got there.</p>
<p>Take a look at the <code>&#x3C;body></code> take of the HTML file:</p>
<pre><code class="language-html">&#x3C;body>
    &#x3C;div id="display">
        &#x3C;!-- script will display content here -->
    &#x3C;/div>

    &#x3C;script src="https://cdnjs.cloudflare.com/ajax/libs/systemjs/0.20.9/system.js">&#x3C;/script>
    &#x3C;script src="bundle.js">&#x3C;/script>
    &#x3C;script>
        SystemJS.config({
            "paths": {
                "moment": "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"
            }
        });

        SystemJS.import("game")
            .then((module)=> {
                let g = new module.Game("display");
                g.start();
            })
            .catch((error)=> {
                console.error(error);
            });
    &#x3C;/script>
&#x3C;/body>
</code></pre>
<p>I blame myself for getting stuck considering this sort all documented well in the <a href="https://github.com/systemjs/systemjs">SystemJS documentation on GitHub</a>. Either way, I had issues finding solid resources about using bundles. Hopefull this can help someone else in the future.</p>
<h2>Conclusion</h2>
<p>My problems can be traced back to my lack of experience with JavaScript module loaders. And yes, I know that <a href="http://caniuse.com/#feat=es6-module">ES6 Modules are coming</a>, but the browsers are a ways away from having a full implementation (except for Safari). </p>
<p>Until then, we'll be using TypeScript and <a href="http://babeljs.io/">Babel</a> to help us get our modular JavaScript working in the browser.</p>
</div></article><footer><a href="/blog">Back to Post Listing</a></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"how-to-compile-typescript-into-a-single-file-with-systemjs-modules-with-gulp","htmlContent":"\u003cp\u003eI've been messing around with TypeScript again for my \u003ca href=\"https://blog.davidwesst.com/2017/03/Intital-Thoughts-on-Using-Phaser/\"\u003egame project\u003c/a\u003e and wanted a module loader to consume the single file produced by the TypeScript compiler. This time around I decided to use SystemJS and figured I'd share the lessons I learned along the way.\u003c/p\u003e\n\u003ch5\u003eSample Project\u003c/h5\u003e\n\u003cp\u003eIf you're interested in playing with the code, you can checkout \u003ca href=\"https://github.com/davidwesst/ts-systemjs\"\u003ethis GitHub project\u003c/a\u003e I setup just for that reason.\u003c/p\u003e\n\u003ch5\u003ePrevious Post\u003c/h5\u003e\n\u003cp\u003eI also posted about doing the same sort of thing \u003ca href=\"https://blog.davidwesst.com/2016/09/How-to-Compile-Typescript-into-a-Single-File-with-AMD-Modules/\"\u003ewith AMD and RequireJS\u003c/a\u003e complete with \u003ca href=\"https://github.com/davidwesst/ts-project-template\"\u003ea GitHub sample project\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eProject Breakdown\u003c/h2\u003e\n\u003cp\u003eHere's the gist of it. My project has the following requirements:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eSource code in TypeScript, organized in to multiple modules\u003c/li\u003e\n\u003cli\u003eLoad external modules into application as dependencies\u003c/li\u003e\n\u003cli\u003eTranspile down to a single bundle file\u003c/li\u003e\n\u003cli\u003eLoad the bundle in the browser\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eIt seems pretty straight forward, right? Plus, because I'm using TypeScript I figured this would be easy peezy lemon-squeezy with the \u003ca href=\"https://www.typescriptlang.org/docs/handbook/compiler-options.html\"\u003eTypeScript compiler\u003c/a\u003e and rich documentation.\u003c/p\u003e\n\u003cp\u003eAs it turns out, it wasn't that simple.\u003c/p\u003e\n\u003ch3\u003eWait. Where's GulpJS?\u003c/h3\u003e\n\u003cp\u003eIt's in the sample project handling the transpiling the TypeScript through a task. \u003c/p\u003e\n\u003cp\u003eIt's actually not required, but rather a convienience for keeping all my build tasks together. I just put it in the title, because it matches the previous post.\u003c/p\u003e\n\u003ch2\u003eProblem 1: Using an External Module\u003c/h2\u003e\n\u003cp\u003eI wanted to use \u003ca href=\"https://momentjs.com/\"\u003eMoment.js\u003c/a\u003e to help handle date objects with my code.\u003c/p\u003e\n\u003cp\u003eThere were two parts to this: \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eGetting it working in the development environment\u003c/li\u003e\n\u003cli\u003eGetting it bundled up with SystemJS.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eUsing it in Development\u003c/h3\u003e\n\u003cp\u003eI use \u003ca href=\"https://code.visualstudio.com/\"\u003eVisual Studio Code\u003c/a\u003e, which is a great TypeScript development environment. \u003c/p\u003e\n\u003cp\u003eNormally, you would use the \u003ca href=\"https://www.npmjs.com/search?q=%40types\"\u003e\u003ccode\u003e@types\u003c/code\u003e\u003c/a\u003e collection of defintion files from the NPM which is wired up by default. For Moment, we need to break that.\u003c/p\u003e\n\u003cp\u003eThe definition file for Moment is found in the library itself. Since I use NPM to handle all my dependencies, you just set this up in your \u003ccode\u003etsconfig.json\u003c/code\u003e file.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/TyAgU0N.png\"\u003e\u003c/p\u003e\n\u003cp\u003eThen, in code, we import it.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport moment from \"moment\";\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRemember: if your project is already using \u003ccode\u003e@types\u003c/code\u003e definition files, you'll need to add that folder to the \u003ccode\u003etypeRoots\u003c/code\u003e collection yourself.\u003c/p\u003e\n\u003ch3\u003eBundling it Up\u003c/h3\u003e\n\u003cp\u003eBecause we're using SystemJS, we need to do is configure it as a path to understand where to find the library when it gets referenced.\u003c/p\u003e\n\u003cp\u003eIn the \u003ca href=\"https://github.com/davidwesst/ts-systemjs\"\u003esample project\u003c/a\u003e, we do it in \u003ccode\u003escript\u003c/code\u003e tag on the HTML page, but you can do this in wherever you end up doing your SystemJS configuration.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eSystemJS.config({\n    \"paths\": {\n        \"moment\": \"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js\"\n    }\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eProblem 2: Loading the Bundle\u003c/h2\u003e\n\u003cp\u003eMaking a bundle is easy. Consuming the bundle is something different.\u003c/p\u003e\n\u003ch3\u003eMaking a Bundle\u003c/h3\u003e\n\u003cp\u003eIf you're interested in bundling your code into a single file with the compiler, you're limited to AMD or SystemJS modules. This is configured in the \u003ccode\u003etsconfig.json\u003c/code\u003e file included in \u003ca href=\"https://github.com/davidwesst/ts-systemjs\"\u003ethe sample project\u003c/a\u003e with the module property. You can read more about it \u003ca href=\"https://www.typescriptlang.org/docs/handbook/modules.html\"\u003ehere in the TypeScript Handbook\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"http://i.imgur.com/gUGeHfI.png\"\u003e\u003c/p\u003e\n\u003ch3\u003eConsuming the Bundle\u003c/h3\u003e\n\u003cp\u003eThis is where I got stuck.\u003c/p\u003e\n\u003cp\u003eNow I have this fancy bundle, but I need to figure out how to consume it in my HTML page. The solution is pretty simple, but it took some research and some tinkering, but I got there.\u003c/p\u003e\n\u003cp\u003eTake a look at the \u003ccode\u003e\u0026#x3C;body\u003e\u003c/code\u003e take of the HTML file:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026#x3C;body\u003e\n    \u0026#x3C;div id=\"display\"\u003e\n        \u0026#x3C;!-- script will display content here --\u003e\n    \u0026#x3C;/div\u003e\n\n    \u0026#x3C;script src=\"https://cdnjs.cloudflare.com/ajax/libs/systemjs/0.20.9/system.js\"\u003e\u0026#x3C;/script\u003e\n    \u0026#x3C;script src=\"bundle.js\"\u003e\u0026#x3C;/script\u003e\n    \u0026#x3C;script\u003e\n        SystemJS.config({\n            \"paths\": {\n                \"moment\": \"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js\"\n            }\n        });\n\n        SystemJS.import(\"game\")\n            .then((module)=\u003e {\n                let g = new module.Game(\"display\");\n                g.start();\n            })\n            .catch((error)=\u003e {\n                console.error(error);\n            });\n    \u0026#x3C;/script\u003e\n\u0026#x3C;/body\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI blame myself for getting stuck considering this sort all documented well in the \u003ca href=\"https://github.com/systemjs/systemjs\"\u003eSystemJS documentation on GitHub\u003c/a\u003e. Either way, I had issues finding solid resources about using bundles. Hopefull this can help someone else in the future.\u003c/p\u003e\n\u003ch2\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eMy problems can be traced back to my lack of experience with JavaScript module loaders. And yes, I know that \u003ca href=\"http://caniuse.com/#feat=es6-module\"\u003eES6 Modules are coming\u003c/a\u003e, but the browsers are a ways away from having a full implementation (except for Safari). \u003c/p\u003e\n\u003cp\u003eUntil then, we'll be using TypeScript and \u003ca href=\"http://babeljs.io/\"\u003eBabel\u003c/a\u003e to help us get our modular JavaScript working in the browser.\u003c/p\u003e\n","layout":"post","title":"How to Compile TypeScript into a Single File with SystemJS Modules with Gulp","categories":["javascript"],"date":"Tue Mar 14 2017 04:47:22 GMT-0500 (Central Daylight Time)","tags":["javascript","typescript","systemjs","modules","gulpjs"],"excerpt":"I decided to move a TypeScript project from AMD modules (i.e. RequireJS) to SystemJS, still using Gulp. In this post, I walk you through the sample project I've created and share the lessons I learned along the way.","authorId":"david_wesst","originalurl":"https://blog.davidwesst.com/2017/03/How-to-Compile-TypeScript-into-a-Single-File-with-SystemJS-Modules-with-Gulp/"}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"how-to-compile-typescript-into-a-single-file-with-systemjs-modules-with-gulp"},"buildId":"-9wn_hi6_-Q32OgH9YOcv","assetPrefix":"https://www.davidwesst.com","runtimeConfig":{},"nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="https://www.davidwesst.com/_next/static/runtime/polyfills-10c88b4b028d13fe33de.js"></script><script async="" data-next-page="/_app" src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/_app.js"></script><script async="" data-next-page="/blog/[id]" src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/pages/blog/%5Bid%5D.js"></script><script src="https://www.davidwesst.com/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="https://www.davidwesst.com/_next/static/chunks/framework.e84fa698c7ee940652bd.js" async=""></script><script src="https://www.davidwesst.com/_next/static/chunks/commons.7c101d7f1672b68d7c1c.js" async=""></script><script src="https://www.davidwesst.com/_next/static/runtime/main-98aa3916935decc0cde3.js" async=""></script><script src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/_buildManifest.js" async=""></script><script src="https://www.davidwesst.com/_next/static/-9wn_hi6_-Q32OgH9YOcv/_ssgManifest.js" async=""></script></body></html>