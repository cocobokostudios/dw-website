{"componentChunkName":"component---src-templates-post-template-js","path":"/blog/how-to-compile-typescript-into-a-single-file-with-systemjs-modules-with-gulp/","result":{"data":{"markdownRemark":{"excerpt":"I’ve been messing around with TypeScript again for my game project and wanted a module loader to consume the single file produced by the TypeScript compiler…","html":"<p>I’ve been messing around with TypeScript again for my <a href=\"https://blog.davidwesst.com/2017/03/Intital-Thoughts-on-Using-Phaser/\">game project</a> and wanted a module loader to consume the single file produced by the TypeScript compiler. This time around I decided to use SystemJS and figured I’d share the lessons I learned along the way.</p>\n<h5>Sample Project</h5>\n<p>If you’re interested in playing with the code, you can checkout <a href=\"https://github.com/davidwesst/ts-systemjs\">this GitHub project</a> I setup just for that reason.</p>\n<h5>Previous Post</h5>\n<p>I also posted about doing the same sort of thing <a href=\"https://blog.davidwesst.com/2016/09/How-to-Compile-Typescript-into-a-Single-File-with-AMD-Modules/\">with AMD and RequireJS</a> complete with <a href=\"https://github.com/davidwesst/ts-project-template\">a GitHub sample project</a></p>\n<h2>Project Breakdown</h2>\n<p>Here’s the gist of it. My project has the following requirements:</p>\n<ol>\n<li>Source code in TypeScript, organized in to multiple modules</li>\n<li>Load external modules into application as dependencies</li>\n<li>Transpile down to a single bundle file</li>\n<li>Load the bundle in the browser</li>\n</ol>\n<p>It seems pretty straight forward, right? Plus, because I’m using TypeScript I figured this would be easy peezy lemon-squeezy with the <a href=\"https://www.typescriptlang.org/docs/handbook/compiler-options.html\">TypeScript compiler</a> and rich documentation.</p>\n<p>As it turns out, it wasn’t that simple.</p>\n<h3>Wait. Where’s GulpJS?</h3>\n<p>It’s in the sample project handling the transpiling the TypeScript through a task. </p>\n<p>It’s actually not required, but rather a convienience for keeping all my build tasks together. I just put it in the title, because it matches the previous post.</p>\n<h2>Problem 1: Using an External Module</h2>\n<p>I wanted to use <a href=\"https://momentjs.com/\">Moment.js</a> to help handle date objects with my code.</p>\n<p>There were two parts to this: </p>\n<ul>\n<li>Getting it working in the development environment</li>\n<li>Getting it bundled up with SystemJS.</li>\n</ul>\n<h3>Using it in Development</h3>\n<p>I use <a href=\"https://code.visualstudio.com/\">Visual Studio Code</a>, which is a great TypeScript development environment. </p>\n<p>Normally, you would use the <a href=\"https://www.npmjs.com/search?q=%40types\"><code class=\"language-text\">@types</code></a> collection of defintion files from the NPM which is wired up by default. For Moment, we need to break that.</p>\n<p>The definition file for Moment is found in the library itself. Since I use NPM to handle all my dependencies, you just set this up in your <code class=\"language-text\">tsconfig.json</code> file.</p>\n<p><img src=\"http://i.imgur.com/TyAgU0N.png\"></p>\n<p>Then, in code, we import it.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> moment <span class=\"token keyword\">from</span> <span class=\"token string\">\"moment\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Remember: if your project is already using <code class=\"language-text\">@types</code> definition files, you’ll need to add that folder to the <code class=\"language-text\">typeRoots</code> collection yourself.</p>\n<h3>Bundling it Up</h3>\n<p>Because we’re using SystemJS, we need to do is configure it as a path to understand where to find the library when it gets referenced.</p>\n<p>In the <a href=\"https://github.com/davidwesst/ts-systemjs\">sample project</a>, we do it in <code class=\"language-text\">script</code> tag on the HTML page, but you can do this in wherever you end up doing your SystemJS configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">SystemJS<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"paths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"moment\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Problem 2: Loading the Bundle</h2>\n<p>Making a bundle is easy. Consuming the bundle is something different.</p>\n<h3>Making a Bundle</h3>\n<p>If you’re interested in bundling your code into a single file with the compiler, you’re limited to AMD or SystemJS modules. This is configured in the <code class=\"language-text\">tsconfig.json</code> file included in <a href=\"https://github.com/davidwesst/ts-systemjs\">the sample project</a> with the module property. You can read more about it <a href=\"https://www.typescriptlang.org/docs/handbook/modules.html\">here in the TypeScript Handbook</a>.</p>\n<p><img src=\"http://i.imgur.com/gUGeHfI.png\"></p>\n<h3>Consuming the Bundle</h3>\n<p>This is where I got stuck.</p>\n<p>Now I have this fancy bundle, but I need to figure out how to consume it in my HTML page. The solution is pretty simple, but it took some research and some tinkering, but I got there.</p>\n<p>Take a look at the <code class=\"language-text\">&lt;body&gt;</code> take of the HTML file:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>display<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- script will display content here --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/systemjs/0.20.9/system.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n        SystemJS<span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"paths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">\"moment\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js\"</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        SystemJS<span class=\"token punctuation\">.</span><span class=\"token function\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"game\"</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">module</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">let</span> g <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">module<span class=\"token punctuation\">.</span>Game</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"display\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                g<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>I blame myself for getting stuck considering this sort all documented well in the <a href=\"https://github.com/systemjs/systemjs\">SystemJS documentation on GitHub</a>. Either way, I had issues finding solid resources about using bundles. Hopefull this can help someone else in the future.</p>\n<h2>Conclusion</h2>\n<p>My problems can be traced back to my lack of experience with JavaScript module loaders. And yes, I know that <a href=\"http://caniuse.com/#feat=es6-module\">ES6 Modules are coming</a>, but the browsers are a ways away from having a full implementation (except for Safari). </p>\n<p>Until then, we’ll be using TypeScript and <a href=\"http://babeljs.io/\">Babel</a> to help us get our modular JavaScript working in the browser.</p>","frontmatter":{"title":"How to Compile TypeScript into a Single File with SystemJS Modules with Gulp","tags":["javascript","typescript","systemjs","modules","gulpjs"],"categories":["development"],"date":"March 14, 2017","description":null,"social_image":null}},"prev":{"frontmatter":{"title":"Introducing My Game Project - March 2017 Devblog"},"fields":{"slug":"/blog/conquest-march-2017-devblog/"}},"next":{"frontmatter":{"title":"Initial Thoughts on Using Phaser"},"fields":{"slug":"/blog/new-post-initial-thoughts-on-phaser/"}}},"pageContext":{"slug":"/blog/how-to-compile-typescript-into-a-single-file-with-systemjs-modules-with-gulp/","prevSlug":"/blog/conquest-march-2017-devblog/","nextSlug":"/blog/new-post-initial-thoughts-on-phaser/"}},"staticQueryHashes":["2555585279","2841359383","3159585216"]}