{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/from-travis-ci-to-github-actions/","result":{"data":{"markdownRemark":{"html":"<p>We recently migrated the continuous integration and deployment workflow for the Western Devs website from Travis CI to GitHub Actions. These are the steps I followed to get it done.</p>\n<!-- more -->\n<p>Travis CI <a href=\"https://blog.travis-ci.com/2020-11-02-travis-ci-new-billing\">announced a new pricing model</a> that <em>could</em> have impact on open source projects that are using Travis for continuous integration and/or deployment. For static websites, like the <a href=\"https://westerndevs.com\">Western Devs website</a> or <a href=\"https://www.davidwesst.com\">personal website</a>, this could result in getting some unforeseen costs. With that in mind, we decided to take the plunge an migrate away from Travis and over to <a href=\"https://docs.github.com/en/free-pro-team@latest/actions\">GitHub Actions</a> as they provide CI and CD workflows free for open source projects.</p>\n<h2>TL;DR; -- Just show me the code</h2>\n<p>Fine. <a href=\"https://github.com/westerndevs/western-devs-website/blob/master/.github/workflows/ci-cd.yml\">Here is is</a>. It is open source after all.</p>\n<p>But just to be clear, this isn't a tutorial on how to code this up, rather its a walkthrough on what it took to get our <a href=\"https://hexo.io/\">Hexo</a> based static site from Travis to GitHub Actions.</p>\n<h2>Start with Mapping Out Your Workflow</h2>\n<p>And I mean <em>workflow</em> and not just the build. </p>\n<p>For the Western Devs, our workflow goes like this:</p>\n<ol>\n<li>Commit a change to the code (i.e. a new blog post)</li>\n<li>Build the website</li>\n<li>If master branch build is successful, deploy the build to production</li>\n<li>Notify the Western Devs of the build result in Slack</li>\n</ol>\n<p>GitHub workflow provides everything we need to do this, and I'll walk you through the code, which you can see for yourself in <a href=\"https://github.com/westerndevs/western-devs-website/blob/master/.github/workflows/ci-cd.yml\">here in our GitHub repo</a>.</p>\n<h3>1. Commit a change to the code (i.e. a new blog post)</h3>\n<p>This is our trigger to start the workflow. That is represented by the <code>on</code> section of the YAML. In our case, we want to trigger the workflow every time there is a pull request created for the master branch, a push to the master branch (i.e. a merge), or a push to any other feature (ft) or hotfix (hf) branches.</p>\n<pre><code class=\"language-yaml\">name: CI/CD\non:\n  push:\n    branches:\n      - master\n      - ft/*\n      - hf/*\n  pull_request:\n    branches: [ master ]\n</code></pre>\n<p>Now we have a workflow that will trigger when we want to. Next, we need to actually build the website.</p>\n<h3>2. Build the website</h3>\n<p>Our build is exceptionally simple-- just generate the site, and if the generation is successful, the build was successful. To do this, we create a <code>build</code> job that handles the work.</p>\n<pre><code class=\"language-yaml\">jobs:\n  build:\n    name: Build and Deploy\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v2 # checkout the source code\n    - uses: actions/setup-node@v1 # setup the environment\n      with:\n        node-version: 12\n    - run: npm install # setup dependencies\n    - run: npm run build # run the build command\n</code></pre>\n<p>The first two steps are using GitHub Actions provided by GitHub themselves. This pulls our source code and the sets up the Node environment that we need to build the website. Once that is done, we  <code>run</code> steps to run shell commands to install our project specific dependendies and run the build script itself. </p>\n<p>The scripts have been defined in our <a href=\"https://github.com/westerndevs/western-devs-website/blob/master/package.json\">project <code>package.json</code> file</a> and are used by the developers to build the site locally as well.</p>\n<h3>3. If master branch build is successful, deploy the build to production</h3>\n<p>If we are talking about the master branch, we want to do a deployment if it is successful. For this step, we added a conditional expression using the <code>github</code> context that is provided to all actions. You can learn more about context and expressions for GitHub Actions in the <a href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/context-and-expression-syntax-for-github-actions#about-contexts-and-expressions\">GitHub Docs here</a>.</p>\n<p>You might also see that were using an encrypted secret using the <code>secret.GITHUB_TOKEN</code> expression. All repositories have this feature in the settings section of the repo, and you can learn more about <a href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets\">creating encrypted secrets for a repository here</a> in the GitHub docs.</p>\n<pre><code class=\"language-yaml\">    - name: Deploy to GitHub Pages\n      if: github.ref == 'refs/heads/master'\n      uses: peaceiris/actions-gh-pages@v3\n      with:\n        github_token: ${{ secrets.GITHUB_TOKEN }}\n        cname: westerndevs.com\n        commit_message: ${{ github.event.head_commit.message }}\n</code></pre>\n<h4>BONUS: Free hosting with GitHub Pages</h4>\n<p>In our case, our deployment target is <a href=\"https://pages.github.com/\">GitHub Pages</a> which provides free hosting and SSL certificates for open source static sites sites like ours. </p>\n<p>We decided to take this opportunity to consilate everything under the GitHub umbrella because it saved us a couple of bucks, and now everything we need to manage the site is in one spot rather than spread across multiple cloud services.</p>\n<h3>4. Notify the Western Devs of the build result in Slack</h3>\n<p>Originally, we had forgotten this step and started to feel it right away. So an issue was created and I put a solution in place in about 15 minutes, thanks to someone else doing all the heavy lifting and publishing their work to the <a href=\"https://github.com/marketplace?type=actions\">GitHub Actions Marketplace</a>.</p>\n<p>Slack supports incoming webhooks, even for for free workspaces. I set that up by following the <a href=\"https://api.slack.com/messaging/webhooks\">Slack documentation</a>, created another secret in our repository and voila, we were back in business wih the notifications.</p>\n<pre><code class=\"language-yaml\">    - name: Notify Slack\n      if: always()\n      uses: 8398a7/action-slack@v3\n      with:\n        status: ${{ job.status }}\n        fields: repo,message,commit,author,action,eventName,ref,workflow,job,took # selectable (default: repo,message)\n      env:\n        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }} # required\n</code></pre>\n<h2>Conclusion</h2>\n<p>The combination of GitHub Actions and GitHub Pages provides every developer with the opportunity to get a taste of DevOps while actually producing something they can show off to their peers and community. Travis CI is, and will continue to be, a great CI/CD solution for developers...but if you're looking for a one-stop-shop for source control, workflow, and hosting. You can't really go wrong with GitHub.</p>","frontmatter":{"title":"From Travis CI to GitHub Actions (and GitHub Pages)"}}},"pageContext":{"slug":"/from-travis-ci-to-github-actions/"}}}